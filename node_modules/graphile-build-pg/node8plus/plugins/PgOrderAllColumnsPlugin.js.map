{"version":3,"sources":["../../src/plugins/PgOrderAllColumnsPlugin.js"],"names":["PgOrderAllColumnsPlugin","builder","hook","values","build","context","extend","pgIntrospectionResultsByKind","introspectionResultsByKind","pgColumnFilter","inflection","pgOmit","omit","describePgEntity","sqlCommentByAddingTags","scope","isPgRowSortEnum","pgIntrospection","table","kind","attribute","filter","attr","classId","id","reduce","memo","ascFieldName","orderByColumnEnum","descFieldName","value","alias","toLowerCase","specs","name"],"mappings":";;;;;;kBAGgB,SAASA,uBAAT,CAAiCC,OAAjC,EAA0C;AACxDA,UAAQC,IAAR,CAAa,wBAAb,EAAuC,CAACC,MAAD,EAASC,KAAT,EAAgBC,OAAhB,KAA4B;AACjE,UAAM;AACJC,YADI;AAEJC,oCAA8BC,0BAF1B;AAGJC,oBAHI;AAIJC,gBAJI;AAKJC,cAAQC,IALJ;AAMJC,sBANI;AAOJC;AAPI,QAQFV,KARJ;AASA,UAAM;AACJW,aAAO,EAAEC,eAAF,EAAmBC,iBAAiBC,KAApC;AADH,QAEFb,OAFJ;AAGA,QAAI,CAACW,eAAD,IAAoB,CAACE,KAArB,IAA8BA,MAAMC,IAAN,KAAe,OAAjD,EAA0D;AACxD,aAAOhB,MAAP;AACD;AACD,WAAOG,OACLH,MADK,EAELK,2BAA2BY,SAA3B,CACGC,MADH,CACUC,QAAQA,KAAKC,OAAL,KAAiBL,MAAMM,EADzC,EAEGH,MAFH,CAEUC,QAAQb,eAAea,IAAf,EAAqBlB,KAArB,EAA4BC,OAA5B,CAFlB,EAGGoB,MAHH,CAGU,CAACC,IAAD,EAAOJ,IAAP,KAAgB;AACtB,UAAIV,KAAKU,IAAL,EAAW,OAAX,CAAJ,EAAyB;AACvB,eAAOI,IAAP;AACD;AACD,YAAMC,eAAejB,WAAWkB,iBAAX,CAA6BN,IAA7B,EAAmC,IAAnC,CAArB;AACA,YAAMO,gBAAgBnB,WAAWkB,iBAAX,CAA6BN,IAA7B,EAAmC,KAAnC,CAAtB;AACAI,aAAOpB,OACLoB,IADK,EAEL;AACE,SAACC,YAAD,GAAgB;AACdG,iBAAO;AACLC,mBAAOJ,aAAaK,WAAb,EADF;AAELC,mBAAO,CAAC,CAACX,KAAKY,IAAN,EAAY,IAAZ,CAAD;AAFF;AADO;AADlB,OAFK,EAUJ,2CAA0CrB,iBACzCS,IADyC,CAEzC,0CAAyCR,uBACzCQ,IADyC,EAEzC;AACEY,cAAM;AADR,OAFyC,CAKzC,EAjBG,CAAP;AAmBAR,aAAOpB,OACLoB,IADK,EAEL;AACE,SAACG,aAAD,GAAiB;AACfC,iBAAO;AACLC,mBAAOF,cAAcG,WAAd,EADF;AAELC,mBAAO,CAAC,CAACX,KAAKY,IAAN,EAAY,KAAZ,CAAD;AAFF;AADQ;AADnB,OAFK,EAUJ,4CAA2CrB,iBAC1CS,IAD0C,CAE1C,0CAAyCR,uBACzCQ,IADyC,EAEzC;AACEY,cAAM;AADR,OAFyC,CAKzC,EAjBG,CAAP;AAmBA,aAAOR,IAAP;AACD,KAhDH,EAgDK,EAhDL,CAFK,EAmDJ,mCAAkCR,MAAMgB,IAAK,GAnDzC,CAAP;AAqDD,GArED;AAsED,C","file":"PgOrderAllColumnsPlugin.js","sourcesContent":["// @flow\nimport type { Plugin } from \"graphile-build\";\n\nexport default (function PgOrderAllColumnsPlugin(builder) {\n  builder.hook(\"GraphQLEnumType:values\", (values, build, context) => {\n    const {\n      extend,\n      pgIntrospectionResultsByKind: introspectionResultsByKind,\n      pgColumnFilter,\n      inflection,\n      pgOmit: omit,\n      describePgEntity,\n      sqlCommentByAddingTags,\n    } = build;\n    const {\n      scope: { isPgRowSortEnum, pgIntrospection: table },\n    } = context;\n    if (!isPgRowSortEnum || !table || table.kind !== \"class\") {\n      return values;\n    }\n    return extend(\n      values,\n      introspectionResultsByKind.attribute\n        .filter(attr => attr.classId === table.id)\n        .filter(attr => pgColumnFilter(attr, build, context))\n        .reduce((memo, attr) => {\n          if (omit(attr, \"order\")) {\n            return memo;\n          }\n          const ascFieldName = inflection.orderByColumnEnum(attr, true);\n          const descFieldName = inflection.orderByColumnEnum(attr, false);\n          memo = extend(\n            memo,\n            {\n              [ascFieldName]: {\n                value: {\n                  alias: ascFieldName.toLowerCase(),\n                  specs: [[attr.name, true]],\n                },\n              },\n            },\n            `Adding ascending orderBy enum value for ${describePgEntity(\n              attr\n            )}. You can rename this field with:\\n\\n  ${sqlCommentByAddingTags(\n              attr,\n              {\n                name: \"newNameHere\",\n              }\n            )}`\n          );\n          memo = extend(\n            memo,\n            {\n              [descFieldName]: {\n                value: {\n                  alias: descFieldName.toLowerCase(),\n                  specs: [[attr.name, false]],\n                },\n              },\n            },\n            `Adding descending orderBy enum value for ${describePgEntity(\n              attr\n            )}. You can rename this field with:\\n\\n  ${sqlCommentByAddingTags(\n              attr,\n              {\n                name: \"newNameHere\",\n              }\n            )}`\n          );\n          return memo;\n        }, {}),\n      `Adding order values from table '${table.name}'`\n    );\n  });\n}: Plugin);\n"]}