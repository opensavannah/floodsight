{"version":3,"sources":["../src/extend.js"],"names":["indent","extend","aExtendedB","WeakMap","INDENT","text","replace","base","extra","hint","keysA","Object","keys","keysB","hints","create","key","hintKey","newValue","oldValue","hintB","get","indexOf","hintA","firstEntityDetails","chalk","magenta","secondEntityDetails","yellow","Error","bold","obj","assign","set","defineProperty","configurable","enumerable","value","writable"],"mappings":";;;;;QAMgBA,M,GAAAA,M;kBAMQC,M;;AAXxB;;;;;;AAEA,MAAMC,aAAa,IAAIC,OAAJ,EAAnB;;AACA,MAAMC,SAAS,IAAf;;AAEO,SAASJ,MAAT,CAAgBK,IAAhB,EAA8B;AACnC,SACED,SAASC,KAAKC,OAAL,CAAa,KAAb,EAAoB,OAAOF,MAA3B,EAAmCE,OAAnC,CAA2C,eAA3C,EAA4D,IAA5D,CADX;AAGD;;AAEc,SAASL,MAAT,CACbM,IADa,EAEbC,KAFa,EAGbC,IAHa,EAIA;AACb,QAAMC,QAAQC,OAAOC,IAAP,CAAYL,IAAZ,CAAd;AACA,QAAMM,QAAQF,OAAOC,IAAP,CAAYJ,KAAZ,CAAd;AACA,QAAMM,QAAQH,OAAOI,MAAP,CAAc,IAAd,CAAd;AACA,OAAK,MAAMC,GAAX,IAAkBN,KAAlB,EAAyB;AACvB,UAAMO,UAAW,YAAWD,GAAI,EAAhC;AACA,QAAIT,KAAKU,OAAL,CAAJ,EAAmB;AACjBH,YAAMG,OAAN,IAAiBV,KAAKU,OAAL,CAAjB;AACD;AACF;;AAED,OAAK,MAAMD,GAAX,IAAkBH,KAAlB,EAAyB;AACvB,UAAMK,WAAWV,MAAMQ,GAAN,CAAjB;AACA,UAAMG,WAAWZ,KAAKS,GAAL,CAAjB;AACA,UAAMC,UAAW,YAAWD,GAAI,EAAhC;AACA,UAAMI,QAAQZ,MAAMS,OAAN,KAAkBR,IAAhC;AACA,QAAIP,WAAWmB,GAAX,CAAeH,QAAf,MAA6BC,QAA7B,IAAyCT,MAAMY,OAAN,CAAcN,GAAd,KAAsB,CAAnE,EAAsE;AACpE;AACA,YAAMO,QAAiBhB,KAAKU,OAAL,CAAvB;AACA,YAAMO,qBAAqB,CAACD,KAAD,GACvB,uDADuB,GAEtB,4BAA2BvB,OAAOyB,gBAAMC,OAAN,CAAcH,KAAd,CAAP,CAA6B,EAF7D;AAGA,YAAMI,sBAAsB,CAACP,KAAD,GACxB,wDADwB,GAEvB,6BAA4BpB,OAAOyB,gBAAMG,MAAN,CAAaR,KAAb,CAAP,CAA4B,EAF7D;AAGA,YAAM,IAAIS,KAAJ,CACH,oFAAmFJ,gBAAMK,IAAN,CAClFd,GADkF,CAElF,SAAQhB,OAAOwB,kBAAP,CAA2B,OAAMxB,OAAO2B,mBAAP,CAA4B,EAHnE,CAAN;AAKD;AACDb,UAAMG,OAAN,IAAiBH,MAAMG,OAAN,KAAkBG,KAAlB,IAA2Bb,KAAKU,OAAL,CAA5C;AACD;AACD,QAAMc,MAAMpB,OAAOqB,MAAP,CAAc,EAAd,EAAkBzB,IAAlB,EAAwBC,KAAxB,CAAZ;AACAN,aAAW+B,GAAX,CAAeF,GAAf,EAAoBxB,IAApB;AACA,OAAK,MAAMU,OAAX,IAAsBH,KAAtB,EAA6B;AAC3B,QAAIA,MAAMG,OAAN,CAAJ,EAAoB;AAClBN,aAAOuB,cAAP,CAAsBH,GAAtB,EAA2Bd,OAA3B,EAAoC;AAClCkB,sBAAc,KADoB;AAElCC,oBAAY,KAFsB;AAGlCC,eAAOvB,MAAMG,OAAN,CAH2B;AAIlCqB,kBAAU;AAJwB,OAApC;AAMD;AACF;AACD,SAAOP,GAAP;AACD","file":"extend.js","sourcesContent":["// @flow\nimport chalk from \"chalk\";\n\nconst aExtendedB = new WeakMap();\nconst INDENT = \"  \";\n\nexport function indent(text: string) {\n  return (\n    INDENT + text.replace(/\\n/g, \"\\n\" + INDENT).replace(/\\n +(?=\\n|$)/g, \"\\n\")\n  );\n}\n\nexport default function extend<Obj1: *, Obj2: *>(\n  base: Obj1,\n  extra: Obj2,\n  hint?: string\n): Obj1 & Obj2 {\n  const keysA = Object.keys(base);\n  const keysB = Object.keys(extra);\n  const hints = Object.create(null);\n  for (const key of keysA) {\n    const hintKey = `_source__${key}`;\n    if (base[hintKey]) {\n      hints[hintKey] = base[hintKey];\n    }\n  }\n\n  for (const key of keysB) {\n    const newValue = extra[key];\n    const oldValue = base[key];\n    const hintKey = `_source__${key}`;\n    const hintB = extra[hintKey] || hint;\n    if (aExtendedB.get(newValue) !== oldValue && keysA.indexOf(key) >= 0) {\n      // $FlowFixMe\n      const hintA: ?string = base[hintKey];\n      const firstEntityDetails = !hintA\n        ? \"We don't have any information about the first entity.\"\n        : `The first entity was:\\n\\n${indent(chalk.magenta(hintA))}`;\n      const secondEntityDetails = !hintB\n        ? \"We don't have any information about the second entity.\"\n        : `The second entity was:\\n\\n${indent(chalk.yellow(hintB))}`;\n      throw new Error(\n        `A naming conflict has occurred - two entities have tried to define the same key '${chalk.bold(\n          key\n        )}'.\\n\\n${indent(firstEntityDetails)}\\n\\n${indent(secondEntityDetails)}`\n      );\n    }\n    hints[hintKey] = hints[hintKey] || hintB || base[hintKey];\n  }\n  const obj = Object.assign({}, base, extra);\n  aExtendedB.set(obj, base);\n  for (const hintKey in hints) {\n    if (hints[hintKey]) {\n      Object.defineProperty(obj, hintKey, {\n        configurable: false,\n        enumerable: false,\n        value: hints[hintKey],\n        writable: false,\n      });\n    }\n  }\n  return obj;\n}\n"]}